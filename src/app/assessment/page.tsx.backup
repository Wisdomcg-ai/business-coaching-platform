'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs';

interface AssessmentResponse {
  [key: string]: string | number | boolean | string[];
}

export default function AssessmentPage() {
  const router = useRouter();
  const supabase = createClientComponentClient();
  const [currentSection, setCurrentSection] = useState(0);
  const [responses, setResponses] = useState<AssessmentResponse>({});
  const [loading, setLoading] = useState(false);
  const [businessId, setBusinessId] = useState<string | null>(null);
  const [userId, setUserId] = useState<string | null>(null);

  useEffect(() => {
    checkUser();
  }, []);

  const checkUser = async () => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push('/auth/login');
        return;
      }
      setUserId(user.id);

      const { data: profile } = await supabase
        .from('profiles')
        .select('business_id')
        .eq('id', user.id)
        .single();

      if (!profile?.business_id) {
        alert('No business found. Please complete setup first.');
        router.push('/dashboard');
        return;
      }
      
      setBusinessId(profile.business_id);
    } catch (error) {
      console.error('Error checking user:', error);
    }
  };

  const sections = [
    {
      title: "Section 1: Business Foundation",
      description: "Understanding your current position and motivation",
      questions: [
        {
          id: 'q1_revenue',
          question: "1. What's your current annual revenue?",
          type: 'radio',
          options: ['Under $250K', '$250K - $1M', '$1M - $3M', '$3M - $5M', '$5M - $10M', '$10M+']
        },
        {
          id: 'q2_profit',
          question: "2. What's your current profit margin?",
          type: 'radio',
          options: ['Losing money', 'Breaking even (0-5%)', 'Small profit (5-10%)', 'Healthy profit (10-15%)', 'Strong profit (15-20%)', 'Exceptional profit (20%+)']
        },
        {
          id: 'q3_salary',
          question: "3. Are you paying yourself a market-rate salary consistently?",
          type: 'radio',
          options: ['No - rarely take money out', 'Sometimes - when cash flow allows', 'Yes - regular salary below market', 'Yes - full market-rate salary', 'Yes - salary plus profit distributions']
        },
        {
          id: 'q4_team',
          question: "4. How many people work in your business?",
          type: 'radio',
          options: ['Just me', '2-5 people', '6-15 people', '16-50 people', '50+ people']
        },
        {
          id: 'q5_dependency',
          question: "5. How dependent is the business on you personally?",
          type: 'radio',
          options: ['Completely - stops without me', 'Very - needs me for most decisions', 'Somewhat - can run for short periods', 'Minimal - runs well without me']
        },
        {
          id: 'q6_predictability',
          question: "6. How predictable is your monthly revenue?",
          type: 'radio',
          options: ['Completely unpredictable', 'Somewhat predictable - within 50%', 'Very predictable - within 25%', 'Extremely predictable - recurring revenue']
        }
      ]
    },
    {
      title: "Section 2: Strategic Wheel Assessment",
      description: "The 6 components that drive business success",
      questions: [
        {
          id: 'q7_vision',
          question: "7. How clear and compelling is your business vision?",
          type: 'radio',
          options: ['Very unclear - no defined direction', 'Somewhat clear - general idea', 'Clear - team understands it', 'Crystal clear - guides all decisions']
        },
        {
          id: 'q8_purpose',
          question: "8. Does your team understand and believe in your purpose?",
          type: 'radio',
          options: ['No understanding or buy-in', 'Some understanding, limited buy-in', 'Good understanding and buy-in', 'Complete alignment and passion']
        },
        {
          id: 'q9_target',
          question: "9. How well-defined is your target market and positioning?",
          type: 'radio',
          options: ['Serve anyone who will pay', 'General target market defined', 'Specific ideal customer profile', 'Laser-focused with clear differentiation']
        },
        {
          id: 'q10_advantage',
          question: "10. Do you have a sustainable competitive advantage?",
          type: 'radio',
          options: ['Compete mainly on price', 'Some differentiation', 'Clear unique value proposition', 'Dominant market position']
        },
        {
          id: 'q11_usps',
          question: "11. Have you clearly defined and do you actively use your USPs?",
          type: 'radio',
          options: ["Don't know what makes us different", 'Have ideas but not clearly defined', 'USPs defined but not consistently used', 'Clear USPs used across all marketing', 'Powerful USPs that resonate with clients']
        },
        {
          id: 'q13_team_culture',
          question: "13. How strong is your team and culture?",
          type: 'radio',
          options: ['Struggling with people issues', 'Adequate team, developing culture', 'Good team, positive culture', 'A-players with exceptional culture']
        },
        {
          id: 'q14_values',
          question: "14. How well-defined and lived are your core values?",
          type: 'radio',
          options: ['No defined core values', "Values exist but aren't used", 'Values guide some decisions', 'Values drive all decisions and hiring']
        },
        {
          id: 'q15_execution',
          question: "15. How systematic is your business execution?",
          type: 'radio',
          options: ['Ad hoc, reactive approach', 'Some systems, inconsistent execution', 'Good systems, reliable execution', 'Exceptional systems and execution']
        },
        {
          id: 'q16_meetings',
          question: "16. Do you have effective meeting rhythms?",
          type: 'radio',
          options: ['Irregular, unproductive meetings', 'Some meetings, limited value', 'Weekly team meetings with agendas', 'Daily huddles, weekly tactical, monthly strategic']
        },
        {
          id: 'q17_metrics',
          question: "17. How well do you track business performance with a dashboard?",
          type: 'radio',
          options: ["Don't track metrics systematically", 'Track basic metrics monthly', 'Weekly dashboard review', 'Real-time dashboard reviewed daily']
        },
        {
          id: 'q18_one_number',
          question: '18. Have you identified your "1 Number" that drives everything?',
          type: 'radio',
          options: ['No idea what this means', 'Track many metrics, no focus', 'Have identified key metric', '"1 Number" drives all decisions']
        },
        {
          id: 'q19_alignment',
          question: "19. How aligned is your team around priorities?",
          type: 'radio',
          options: ['Little to no alignment', 'Some alignment, poor communication', 'Good alignment and communication', 'Perfect alignment and rhythm']
        },
        {
          id: 'q20_communications',
          question: "20. How organized are your team communications?",
          type: 'radio',
          options: ['Scattered across multiple channels', 'Multiple channels but manageable', 'Streamlined to 2-3 main channels', 'One primary platform for all communication']
        }
      ]
    },
    {
      title: "Section 3: Profitability Health Check",
      description: "Understanding your path to target profit margins",
      questions: [
        {
          id: 'q21_profit_blockers',
          question: "21. What prevents you from achieving your target profit margin? (Check all that apply)",
          type: 'checkbox',
          options: [
            'Prices are too low for value delivered',
            'Costs are not well controlled',
            "Don't know true profit by product/service",
            'Too many discounts given',
            'Inefficient operations increase costs',
            'High customer acquisition costs',
            'Poor cash flow management',
            'Overhead too high for revenue'
          ]
        },
        {
          id: 'q22_price_increase',
          question: "22. When did you last increase prices?",
          type: 'radio',
          options: ['Never or over 2 years ago', '1-2 years ago', '6-12 months ago', 'Within last 6 months']
        },
        {
          id: 'q23_pricing_confidence',
          question: "23. How confident are you in your pricing strategy?",
          type: 'radio',
          options: ['Very unsure - often discount', 'Somewhat confident - occasional doubts', 'Confident - rarely questioned', 'Very confident - optimal pricing']
        },
        {
          id: 'q24_expense_review',
          question: "24. How often do you review and audit your business expenses?",
          type: 'radio',
          options: ['Never or only when cash tight', 'Annually', 'Quarterly', 'Monthly with action taken']
        },
        {
          id: 'q25_subscriptions',
          question: "25. Do you regularly review and cancel unused subscriptions/services?",
          type: 'radio',
          options: ['No - probably paying for unused', 'Occasionally when I notice', 'Annual review of all', 'Quarterly audit with cancellations']
        },
        {
          id: 'q26_negotiations',
          question: "26. When did you last negotiate with suppliers for better pricing?",
          type: 'radio',
          options: ['Never or over 2 years ago', 'Within the last 2 years', 'Within the last year', 'Within the last 6 months']
        }
      ]
    },
    {
      title: "Section 4: Business Engines Assessment",
      description: "The core engines that power your business growth",
      questions: [
        {
          id: 'q27_leads',
          question: "27. How many qualified leads do you generate monthly?",
          type: 'radio',
          options: ['Under 20 leads', '20-50 leads', '50-100 leads', '100+ leads']
        },
        {
          id: 'q28_channels',
          question: "28. How many reliable marketing channels generate leads?",
          type: 'radio',
          options: ['No consistent channels', '1-2 inconsistent sources', '3-4 regular sources', '5+ systematic channels']
        },
        {
          id: 'q29_marketing_process',
          question: "29. Do you have a documented marketing process?",
          type: 'radio',
          options: ['No process at all', "Have process but don't follow", 'Follow it sometimes', 'Follow it consistently']
        },
        {
          id: 'q30_lead_systems',
          question: "30. How systematic is your lead generation? (Check all that apply)",
          type: 'checkbox',
          options: [
            'We have a referral system generating 30%+ of business',
            'We email our database/leads regularly',
            'We track ROI for each marketing channel',
            'We know our cost per lead and CAC'
          ]
        },
        {
          id: 'q31_conversion',
          question: "31. What's your lead-to-customer conversion rate?",
          type: 'radio',
          options: ["Under 15% or don't track", '15-25%', '25-40%', 'Over 40%']
        },
        {
          id: 'q32_sales_process',
          question: "32. Do you have a documented sales process that you follow?",
          type: 'radio',
          options: ['No process at all', "Have process but don't follow", 'Follow it sometimes', 'Follow it consistently']
        },
        {
          id: 'q33_sales_capability',
          question: "33. How effective is your sales capability? (Check all that apply)",
          type: 'checkbox',
          options: [
            'We follow up multiple times with prospects',
            'We contact prospects who did not sign',
            'We have ready answers for objections',
            'We always ask for the business'
          ]
        },
        {
          id: 'q34_transaction_value',
          question: "34. Do you maximize transaction value? (Check all that apply)",
          type: 'checkbox',
          options: [
            'We offer different price points',
            'We regularly offer additional products/services',
            'We can explain pricing without apologizing',
            'Our prices are based on value, not costs'
          ]
        },
        {
          id: 'q35_customer_delight',
          question: "35. What percentage of customers are delighted with your delivery?",
          type: 'radio',
          options: ['Under 60%', '60-75%', '75-90%', 'Over 90%']
        },
        {
          id: 'q37_delivery_process',
          question: "37. Do you have a documented delivery process that you follow?",
          type: 'radio',
          options: ['No process at all', "Have process but don't follow", 'Follow it sometimes', 'Follow it consistently']
        },
        {
          id: 'q38_satisfaction',
          question: "38. How do you measure and track customer satisfaction?",
          type: 'radio',
          options: ["Don't measure systematically", 'Occasional informal feedback', 'Regular satisfaction surveys', 'Comprehensive feedback with action plans']
        },
        {
          id: 'q39_customer_journey',
          question: "39. How exceptional is your customer journey? (Check all that apply)",
          type: 'checkbox',
          options: [
            'Our onboarding impresses new customers',
            'We have mapped every customer touchpoint',
            'Customers can easily reach us when needed',
            'We systematically review and improve experience'
          ]
        },
        {
          id: 'q40_talent',
          question: "40. How strategic is your approach to talent?",
          type: 'radio',
          options: ['Reactive hiring when desperate', 'Basic hiring process', 'Good hiring with criteria', 'Systematic recruitment of A-players']
        },
        {
          id: 'q41_performance',
          question: "41. Do you have a performance management system?",
          type: 'radio',
          options: ['No formal management', 'Occasional informal feedback', 'Regular reviews without criteria', 'Systematic reviews against KPIs']
        },
        {
          id: 'q42_team_development',
          question: "42. How effectively do you develop your team? (Check all that apply)",
          type: 'checkbox',
          options: [
            'Every role has documented responsibilities',
            'We invest in team training',
            'We strategically outsource non-core',
            'Team is accountable for results'
          ]
        },
        {
          id: 'q43_documentation',
          question: "43. How comprehensive is your process documentation?",
          type: 'radio',
          options: ["Most processes in people's heads", 'Some processes documented', 'Most key processes documented', 'All processes documented']
        },
        {
          id: 'q44_audits',
          question: "44. How often do you audit if systems are being followed?",
          type: 'radio',
          options: ['Never audit compliance', 'Only when problems arise', 'Annual system audits', 'Quarterly audits with improvements']
        },
        {
          id: 'q45_infrastructure',
          question: "45. How advanced is your operational infrastructure? (Check all that apply)",
          type: 'checkbox',
          options: [
            'We have robust data backup and security',
            'We have documented retention processes',
            'Our technology is current and integrated',
            'We measure process efficiency and cycle times'
          ]
        },
        {
          id: 'q46_budget',
          question: "46. Do you have a comprehensive P&L budget/forecast?",
          type: 'radio',
          options: ['No budget or forecast', 'Basic revenue/expense tracking', 'Annual budget created', 'Detailed budget with variance analysis']
        },
        {
          id: 'q47_cashflow',
          question: "47. Do you maintain cash flow forecasts?",
          type: 'radio',
          options: ['No cash flow forecasting', 'Check bank when needed', 'Monthly cash flow review', '13-week rolling forecast']
        },
        {
          id: 'q48_pricing_knowledge',
          question: "48. Which statement best describes your understanding of pricing?",
          type: 'radio',
          options: ["Not sure of markup vs margin", "Understand but don't use strategically", 'Calculate both and understand impact', 'Optimize using both analyses']
        },
        {
          id: 'q49_working_capital',
          question: "49. How well do you manage profitability? (Check all that apply)",
          type: 'checkbox',
          options: [
            'We maintain 3+ months cash reserves',
            'We actively manage cash conversion cycle',
            'We know which products are most profitable',
            'We increased prices in last 12 months'
          ]
        }
      ]
    },
    {
      title: "Section 5: Success Disciplines Assessment",
      description: "Evaluate your strength in 12 key disciplines - Check all that apply for each discipline",
      questions: [
        {
          id: 'disc_decision',
          question: "Decision-Making Frameworks",
          type: 'checkbox',
          options: [
            'I have clear criteria for different types of decisions',
            'I make small decisions quickly without overthinking',
            'I know which decisions need deep analysis vs quick action',
            'I rarely procrastinate on important decisions',
            'I have defined decision-making authority levels'
          ]
        },
        {
          id: 'disc_technology',
          question: "Technology & AI Integration",
          type: 'checkbox',
          options: [
            'We use technology effectively for marketing automation',
            'We track and manage all customer interactions systematically',
            'We use AI for content creation or customer service',
            'We use AI for data analysis or insights',
            'We regularly evaluate new technology opportunities'
          ]
        },
        {
          id: 'disc_growth',
          question: "Growth Mindset & Learning",
          type: 'checkbox',
          options: [
            'I dedicate time weekly to learning new business skills',
            'I read business books or listen to podcasts regularly',
            'Our team has learning and development plans',
            'We document and share lessons from wins and failures',
            'We have a culture of continuous improvement'
          ]
        },
        {
          id: 'disc_leadership',
          question: "Leadership Development",
          type: 'checkbox',
          options: [
            'Others naturally follow my vision and direction',
            'I am developing other leaders in the business',
            'I delegate effectively and empower my team',
            'I regularly assess and improve my leadership skills',
            'I spend time working ON the business, not just IN it'
          ]
        },
        {
          id: 'disc_personal',
          question: "Personal Mastery",
          type: 'checkbox',
          options: [
            'I have a morning ritual including planning and goals review',
            'I can maintain deep focus for 2+ hours on important work',
            'I take at least 30 minutes daily for exercise/physical activity',
            'I plan each day in advance with specific outcomes',
            'I consistently maintain high energy throughout the workday'
          ]
        },
        {
          id: 'disc_operational',
          question: "Operational Excellence",
          type: 'checkbox',
          options: [
            'We have standard operating procedures that everyone follows',
            'Our business could operate effectively without me for 6 weeks',
            'We regularly review and optimize our systems',
            'We measure and improve operational efficiency metrics',
            'We have quality control systems in place'
          ]
        },
        {
          id: 'disc_resource',
          question: "Resource Optimization",
          type: 'checkbox',
          options: [
            'We maximize utilization of physical assets and space',
            'Our people are deployed in their highest-value roles',
            'We have eliminated or outsourced non-core activities',
            'We regularly review and optimize all resource allocation',
            'We track ROI on all major investments and decisions'
          ]
        },
        {
          id: 'disc_financial',
          question: "Financial Acumen",
          type: 'checkbox',
          options: [
            'I review financial metrics weekly',
            'I understand my profit per customer/job/unit sold',
            'We track budget vs actual with variance analysis',
            'I make decisions based on financial impact',
            'We actively manage cash flow to avoid surprises'
          ]
        },
        {
          id: 'disc_accountability',
          question: "Accountability & Performance Management",
          type: 'checkbox',
          options: [
            'Every team member has clear KPIs and scorecards',
            'We conduct regular performance reviews',
            'People consistently do what they say they will do',
            'I hold myself accountable to my commitments',
            'We have a culture of ownership and responsibility'
          ]
        },
        {
          id: 'disc_customer',
          question: "Customer Experience",
          type: 'checkbox',
          options: [
            'Customers are delighted and become advocates',
            'We systematically gather and act on customer feedback',
            'We maintain strong relationships beyond the initial transaction',
            'We exceed expectations at every touchpoint',
            'We have a customer success process, not just customer service'
          ]
        },
        {
          id: 'disc_resilience',
          question: "Resilience & Renewal",
          type: 'checkbox',
          options: [
            'I have scheduled breaks and renewal time',
            'I work less than 50 hours per week consistently',
            'I have scheduled time off in the next 12 months',
            'I bounce back quickly from setbacks',
            'I maintain work-life integration that energizes me'
          ]
        },
        {
          id: 'disc_time',
          question: "Time Management & Effectiveness",
          type: 'checkbox',
          options: [
            'I use a prioritization system (urgent/important matrix or similar)',
            'I maintain and work from organized to-do lists daily',
            'I calendar-block my most important activities',
            'I have a Stop Doing List to eliminate low-value activities',
            'I protect my time by saying no to non-essential requests'
          ]
        }
      ]
    },
    {
      title: "Section 6: Strategic Priorities & Goals",
      description: "Define your focus areas and targets",
      questions: [
        {
          id: 'q50_constraint',
          question: "50. What's the single biggest constraint holding your business back?",
          type: 'text',
          placeholder: "Describe your biggest challenge..."
        },
        {
          id: 'q51_opportunity',
          question: "51. What's your biggest opportunity for growth right now?",
          type: 'text',
          placeholder: "Describe your biggest opportunity..."
        },
        {
          id: 'q52_90day',
          question: "52. If you could fix ONE thing in the next 90 days for maximum impact, what would it be?",
          type: 'text',
          placeholder: "Your top priority..."
        },
        {
          id: 'q53_help',
          question: "53. Where do you need the most help to achieve your goals?",
          type: 'text',
          placeholder: "Areas where you need support..."
        }
      ]
    }
  ];

  // Calculate total questions - simplified count
  const totalQuestions = 54; // We know it's 54 questions total

  // Calculate answered questions
  const getAnsweredCount = () => {
    let count = 0;
    sections.forEach(section => {
      section.questions.forEach(q => {
        if (responses[q.id] !== undefined && responses[q.id] !== '') {
          count++;
        }
      });
    });
    return count;
  };

  const currentSectionData = sections[currentSection];
  const questionsInSection = currentSectionData.questions.length;
  const overallProgress = Math.round((getAnsweredCount() / totalQuestions) * 100);

  const calculateScore = () => {
    let score = 0;
    let maxScore = 0;
    
    sections.forEach(section => {
      section.questions.forEach(question => {
        const response = responses[question.id];
        
        if (question.type === 'radio' && response) {
          maxScore += 4;
          const optionIndex = question.options?.indexOf(response as string) || 0;
          const optionScore = (optionIndex / ((question.options?.length || 1) - 1)) * 4;
          score += optionScore;
        } else if (question.type === 'checkbox' && response) {
          const checkedItems = response as string[];
          maxScore += 4;
          score += (checkedItems.length / (question.options?.length || 1)) * 4;
        }
      });
    });
    
    return Math.round((score / maxScore) * 100);
  };

  const handleSubmit = async () => {
    if (!businessId || !userId) {
      alert('Missing business or user information. Please try again.');
      return;
    }

    setLoading(true);
    
    try {
      const score = calculateScore();
      
      const { data, error } = await supabase
        .from('assessments')
        .insert({
          business_id: businessId,
          completed_by: userId,
          responses: responses,
          score: score,
          completion_percentage: 100
        })
        .select()
        .single();

      if (error) throw error;

      router.push(`/assessment/results?id=${data.id}`);
    } catch (error: any) {
      console.error('Error saving assessment:', error);
      alert(`Failed to save assessment: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };

  const handleNext = () => {
    if (currentSection < sections.length - 1) {
      setCurrentSection(currentSection + 1);
      window.scrollTo(0, 0);
    } else {
      handleSubmit();
    }
  };

  const handleBack = () => {
    if (currentSection > 0) {
      setCurrentSection(currentSection - 1);
      window.scrollTo(0, 0);
    }
  };

  const handleResponse = (questionId: string, value: any) => {
    setResponses(prev => ({
      ...prev,
      [questionId]: value
    }));
  };

  const handleCheckboxResponse = (questionId: string, value: string, checked: boolean) => {
    const current = (responses[questionId] as string[]) || [];
    if (checked) {
      handleResponse(questionId, [...current, value]);
    } else {
      handleResponse(questionId, current.filter(v => v !== value));
    }
  };

  const isCurrentSectionComplete = () => {
    return currentSectionData.questions.every(q => {
      if (q.type === 'text' || q.type === 'checkbox') {
        return true; // Optional
      }
      return responses[q.id] !== undefined && responses[q.id] !== '';
    });
  };

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-4xl mx-auto px-4">
        {/* Progress Header */}
        <div className="mb-8">
          <div className="flex justify-between items-center mb-4">
            <h1 className="text-2xl font-bold">Business Development Diagnostic</h1>
            <button
              onClick={() => router.push('/dashboard')}
              className="text-gray-600 hover:text-gray-900"
            >
              Save & Exit
            </button>
          </div>
          
          {/* Section Progress */}
          <div className="bg-white rounded-lg shadow-sm p-4 mb-4">
            <div className="flex justify-between items-center mb-2">
              <span className="text-sm font-medium">
                Section {currentSection + 1} of {sections.length}: {questionsInSection} questions
              </span>
              <span className="text-sm text-gray-600">
                Overall: {getAnsweredCount()} of {totalQuestions} questions ({overallProgress}%)
              </span>
            </div>
            
            {/* Overall Progress Bar */}
            <div className="w-full bg-gray-200 rounded-full h-2 mb-3">
              <div 
                className="bg-green-600 h-2 rounded-full transition-all duration-300"
                style={{ width: `${overallProgress}%` }}
              />
            </div>
            
            {/* Section Progress Bar */}
            <div className="text-xs text-gray-500 mb-1">Current Section Progress</div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div 
                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                style={{ width: `${((currentSection + 1) / sections.length) * 100}%` }}
              />
            </div>
          </div>
        </div>

        {/* Section Content */}
        <div className="bg-white rounded-lg shadow-sm p-6">
          <h2 className="text-xl font-semibold mb-2">{currentSectionData.title}</h2>
          <p className="text-gray-600 mb-6">{currentSectionData.description}</p>
          
          <div className="space-y-6">
            {currentSectionData.questions.map((question) => (
              <div key={question.id} className="space-y-3">
                <label className="block text-gray-700 font-medium">
                  {question.question}
                </label>
                
                {question.type === 'radio' && (
                  <div className="space-y-2">
                    {question.options?.map((option) => (
                      <label key={option} className="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input
                          type="radio"
                          name={question.id}
                          value={option}
                          checked={responses[question.id] === option}
                          onChange={(e) => handleResponse(question.id, e.target.value)}
                          className="mr-3"
                        />
                        <span>{option}</span>
                      </label>
                    ))}
                  </div>
                )}
                
                {question.type === 'checkbox' && (
                  <div className="space-y-2">
                    {question.options?.map((option) => (
                      <label key={option} className="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input
                          type="checkbox"
                          value={option}
                          checked={(responses[question.id] as string[] || []).includes(option)}
                          onChange={(e) => handleCheckboxResponse(question.id, option, e.target.checked)}
                          className="mr-3"
                        />
                        <span>{option}</span>
                      </label>
                    ))}
                  </div>
                )}
                
                {question.type === 'text' && (
                  <textarea
                    value={responses[question.id] as string || ''}
                    onChange={(e) => handleResponse(question.id, e.target.value)}
                    className="w-full p-3 border rounded-lg"
                    rows={3}
                    placeholder={question.placeholder}
                  />
                )}
              </div>
            ))}
          </div>
        </div>

        {/* Navigation */}
        <div className="flex justify-between mt-6">
          <button
            onClick={handleBack}
            disabled={currentSection === 0}
            className="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50"
          >
            ← Previous
          </button>
          
          <button
            onClick={handleNext}
            disabled={!isCurrentSectionComplete() || loading}
            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
          >
            {loading ? 'Saving...' : currentSection === sections.length - 1 ? 'Complete Assessment' : 'Next Section →'}
          </button>
        </div>
      </div>
    </div>
  );
}
